{% block _web_catalog_menu_widget %}
    {% set categoriesAttr = layout_attr_defaults(attr, {
        '~class': ' main-menu__item'
    }) %}
    {% set hasSublist = menu_item.children is not empty %}
    {% set categoryAttr = categoriesAttr %}
    {% if hasSublist|default(false)  %}
        {% set categoryAttr = layout_attr_defaults(categoryAttr, {
            '~class': ' main-menu__item--ancestor'
        }) %}
    {% endif  %}
    {% do block|merge_context({'menu_item': menu_item}) %}
    {% for child in block -%}
        {% if child.vars.visible %}
            {{ block_widget(child, {attr: categoryAttr}) }}
        {% endif %}
    {%- endfor %}
{% endblock %}

{% block _web_catalog_menu_first_level_item_mega_widget %}
    {% set sub_block = '_web_catalog_menu_main_menu_sub_block_mega' %}
    {{ block('_web_catalog_menu_main_menu_link') }}
{% endblock %}

{% block _web_catalog_menu_second_level_sale_mega_widget %}
    {% set label = 'On Sale' %}
    {% set content %}
        <li class="main-menu-column__item">
            <a class="main-menu-column__link" href="#">
                <img class="main-menu-column__image"
                     alt="Sale banner 2"
                     src="{{- asset('bundles/orowebcatalog/images/onsale_1.jpg') -}}"
                     loading="lazy">
            </a>
        </li>
    {% endset %}
    {{ block('_web_catalog_menu_second_level_column') }}
{% endblock %}

{% block _web_catalog_menu_second_level_item_mega_widget %}
    {% for menu_item in menu_items %}
        {% if menu_item.displayed and menu_item.extras.isAllowed %}
            {% set two_column = loop.index == 1 %}
            {% set hasSublist = menu_item.children is not empty %}

            {% set label = menu_item.label %}
            {% set addClass = two_column ? 'main-menu-column--splited' %}
            {% set contentTag = 'div' %}
            {% set content %}
                {% if hasSublist %}
                    {% do block|merge_context({
                        'menu_items': menu_item.children,
                        'two_column': two_column,
                    }) %}
                    {{ block('container_widget') }}
                {% endif %}
            {% endset %}
            {{ block('_web_catalog_menu_second_level_column') }}
        {% endif %}
    {% endfor %}
{% endblock %}

{% block _web_catalog_menu_third_level_item_mega_widget %}
    {% for menu_item in menu_items %}
        {% if menu_item.displayed and menu_item.extras.isAllowed %}
            {% if two_column or loop.first %}
            <ul role="menu" class="main-menu-column__inner-{{ loop.index % 2 ? 'left' : 'right' }}">
            {% endif %}
                {{ block('_web_catalog_menu_second_level_item') }}
                {% set hasSublist = menu_item.children is not empty %}
                {% if hasSublist %}
                    {% do block|merge_context({'menu_items': menu_item.children }) %}
                    {{ block('container_widget') }}
                {% endif %}
            {% if two_column or loop.last %}
            </ul>
            {% endif %}
        {% endif %}
    {% endfor %}
{% endblock %}

{% block _web_catalog_menu_four_level_item_mega_widget %}
    {% for menu_item in menu_items %}
        {{ block('_web_catalog_menu_third_level_item') }}
    {% endfor %}
{% endblock %}

{% block _web_catalog_menu_main_menu_link %}
    {%- if menu_item.displayed and menu_item.extras.isAllowed %}
        <li {{ block('block_attributes') }}>
            {% set hasSublist = menu_item.children is not empty %}
            {% set menuLinkId = 'menu-link-'|uniqid %}
            <a href="{{ oro_commercemenu_get_url(menu_item.uri) }}" role="menuitem"
               id="{{ menuLinkId }}"
               class="main-menu__link"
               {% if hasSublist %}
                   aria-haspopup="true"
                   aria-expanded="false"
               {% endif %}
            >
                <span class="main-menu__text">{{ menu_item.label }}</span>
            </a>
            {% if hasSublist %}
                {% set menuButtonId = 'button-'|uniqid %}
                <button class="main-menu__button-arrow"
                        type="button"
                        data-toggle="dropdown"
                        data-popper="false"
                        data-go-to="next"
                        data-ignore-navigation=""
                        id="{{ menuButtonId }}"
                        aria-haspopup="true"
                        aria-expanded="false"
                        aria-label="{{ menu_item.label }}"
                ></button>
                {% set togglerId = menuLinkId  ~ ' ' ~ menuButtonId%}
                {% do block|merge_context({'togglerId': togglerId}) %}
                {{ block(sub_block) }}
            {% endif %}
        </li>
    {%- endif %}
{% endblock %}

{% block _web_catalog_menu_second_level_column %}
    <div class="main-menu-column {{ addClass|default('') }}" data-role="sub-menu">
        <p class="main-menu-column__title">
            {{ label }}
        </p>
        <{{ contentTag|default('ul') }} class="main-menu-column__inner">
            {{ content }}
        </{{ contentTag|default('ul') }}>
    </div>
{% endblock  %}

{% block _web_catalog_menu_main_menu_sub_block_mega %}
    <div class="main-menu__sublist-container"
         data-header-row-toggle
         data-scroll="true"
         aria-labelledby="{{ togglerId }}"
         role="menu"
         data-role="sub-menu"
         aria-hidden="true"
    >
        <div class="main-menu-columns">
            {% do block|merge_context({'menu_items': menu_item.children }) %}
            {{ block('container_widget') }}
        </div>
    </div>
{% endblock  %}

{% block _web_catalog_menu_second_level_item %}
    {%- if menu_item.displayed and menu_item.extras.isAllowed %}
        <li class="main-menu-column__item">
            <a role="menuitem" class="main-menu-column__link" href="{{ oro_commercemenu_get_url(menu_item.uri) }}">{{ menu_item.label }}</a>
        </li>
    {%- endif %}
{% endblock %}

{% block _web_catalog_menu_third_level_item %}
    {%- if menu_item.displayed and menu_item.extras.isAllowed %}
        <li class="main-menu-column__subitem">
            <a role="menuitem" class="main-menu-column__link" href="{{ oro_commercemenu_get_url(menu_item.uri) }}">{{ menu_item.label }}</a>
            {% if menu_item.children is not empty %}
                <ul role="menu" class="main-menu-column__inner">
                {% for menu_child in menu_item.children %}
                    {% with { menu_item: menu_child } %}
                        {{ block('_web_catalog_menu_third_level_item') }}
                    {% endwith %}
                {% endfor %}
                </ul>
            {% endif %}
        </li>
    {%- endif %}
{% endblock %}
